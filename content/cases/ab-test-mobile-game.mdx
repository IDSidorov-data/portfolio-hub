---
title: "Cookie Cats: перенос гейта 40→30 ↑ D7 (A/B-тест)"
summary: "Статистически значимый рост удержания D7 при gate_30 → раскатка победителя."
tags: ["A/B","SQL","PostgreSQL (Docker)","Python/statsmodels","+0.82 п.п. D7 (p=0.0016)"]
role: "Product/Data Analyst"
duration: "5 дней (подготовка → анализ → рекомендации)"
status: "prod"
links:
  - { label: "Код (репозиторий)", href: "https://github.com/IDSidorov-data/mobile-game-ab-test-analysis" }
---

<div className="result-callout">
  <strong>TL;DR.</strong> Вариант <code>gate_30</code> даёт <strong>+0.82 п.п.</strong> к удержанию D7
  (<code>19.02%</code> vs <code>18.20%</code>, <strong>p=0.0016</strong> ≈ <em>+4.5% относит.</em>).
  Рекомендовано раскатить <code>gate_30</code> на 100% с пост-мониторингом.
</div>

<div className="mt-3 flex flex-wrap gap-2">
  <span className="chip chip-positive"><strong>D7</strong>: +0.82 п.п. (p=0.0016)</span>
  <span className="chip chip-neutral">Выборка: gate_30 = 44&nbsp;700; gate_40 = 45&nbsp;489</span>
  <a className="chip chip-neutral" href="https://github.com/IDSidorov-data/mobile-game-ab-test-analysis" target="_blank" rel="noopener noreferrer">GitHub</a>
</div>

## Контекст
Free-to-play головоломка. «Гейт» — обязательная задержка/барьер; позиция влияет на ритм игры и удержание.

## Задача
Проверить гипотезу: перенос «гейта» с **40 → 30** уровня улучшит вовлечённость и **удержание D7**.

## Моя роль
- Сформулировал метрики (D1/D7), дизайн теста, критерии успеха.
- Построил ETL: CSV → **PostgreSQL (Docker)** → агрегации **SQL**.
- Провёл проверку значимости (**Z-тест разности долей**).
- Сформировал план раскатки и пост-мониторинга.

## Данные и подготовка
Исторические события по пользователям (CSV) загружаются в базу данных и агрегируются SQL (считаем размер групп и удержание).

<details>
  <summary><strong>Показать технические детали (SQL)</strong></summary>

```sql title="Агрегирование метрик"
SELECT 
  version,
  COUNT(userid)                         AS total_users,
  SUM(CAST(retention_1 AS int))         AS d1_retained,
  SUM(CAST(retention_7 AS int))         AS d7_retained,
  100.0 * SUM(CAST(retention_1 AS int)) / COUNT(*) AS d1_rate,
  100.0 * SUM(CAST(retention_7 AS int)) / COUNT(*) AS d7_rate
FROM cookie_cats
GROUP BY version;
```
</details>

## Сводные метрики (из БД)

| Группа  | Пользователи | D1 (%, agg) | D7 (%, agg) |
|:--------|-------------:|------------:|------------:|
| gate_30 | 44 700       | 44.82       | **19.02**   |
| gate_40 | 45 489       | 44.23       | 18.20       |

## Методология (простыми словами)
Мы сравнили долю пользователей, вернувшихся на 7-й день, между группами `gate_30` и `gate_40`.  
Использовали **Z-тест разности долей**: он отвечает, насколько вероятно увидеть такое превосходство `gate_30`, если на самом деле разницы нет. Получили **p=0.0016** — это значительно ниже 0.05, значит выигрыш статистически значим.

<details>
  <summary><strong>Показать расчёты (Python)</strong></summary>

```python title="Проверка значимости"
from statsmodels.stats.proportion import proportions_ztest

count = [8502, 8279]    # удержались на D7: gate_30, gate_40
nobs  = [44700, 45489]  # всего пользователей: gate_30, gate_40
z, p = proportions_ztest(count, nobs, alternative='larger')
print(p)  # ≈ 0.0016
```
</details>

## Результаты → решение

- **D7:** +0.82 п.п. (19.02% vs 18.20%), **p=0.0016** — значимо.  
- **D1:** +0.59 п.п., _p≈0.074_ — тренд без значимости.

**Рекомендации:**
1. Раскатить `gate_30` на **100%**.
2. Мониторить: D1/D7, активные раунды, воронка IAP/ADS, SRM/сезонность (1–2 цикла апдейтов).
3. **Rollback-критерии:** деградация D7/денежных метрик за пределы доверительных интервалов.

## Риски/ограничения

- Микс трафика и сезонность могут смещать эффект.
- Влияние на монетизацию проявляется с лагом (нужно пост-наблюдение).

## Стек и запуск
Ниже — краткие шаги для воспроизведения результатов. Для менеджеров этого блока можно не касаться — он для инженера/аналитика.

<details>
  <summary><strong>Показать шаги запуска (локально)</strong></summary>

```bash title="Локально: запуск анализа"
docker compose up -d
pip install -r requirements.txt
python load_data.py
# анализ — в analysis.ipynb
```
</details>
